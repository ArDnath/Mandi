# 403 Error Fix - Quick Guide

## The Problem

You were getting this error on Vercel:

```
Error: Request failed : 403
```

**Root Cause:** The file `lib/config/env.ts` was using strict Zod validation that **required** all environment variables, including:

- `AUTH_GOOGLE_ID` (wrong variable name)
- `AUTH_GOOGLE_SECRET` (wrong variable name)

When these weren't present in your Vercel environment, the app crashed with a 403 error.

## The Fix

Updated [`lib/config/env.ts`](<file:///home/ariyaman/OpenSource/E-Commerce%20Catalog%20&%20Cart%20(Fake%20Store)/ecommerce/lib/config/env.ts>) to:

1. **Make OAuth variables optional** - Google sign-in is now truly optional
2. **Use correct variable names** - Changed to `GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_SECRET` (NextAuth standard)

### Before:

```typescript
const zodEnv = z.object({
  DATABASE_URL: z.string(),
  AUTH_SECRET: z.string(),
  AUTH_GOOGLE_ID: z.string(), // ❌ Wrong name, required
  AUTH_GOOGLE_SECRET: z.string(), // ❌ Wrong name, required
});
```

### After:

```typescript
const zodEnv = z.object({
  DATABASE_URL: z.string(),
  AUTH_SECRET: z.string(),
  GOOGLE_CLIENT_ID: z.string().optional(), // ✅ Correct name, optional
  GOOGLE_CLIENT_SECRET: z.string().optional(), // ✅ Correct name, optional
});
```

## Required Environment Variables in Vercel

### Minimum (Required)

```bash
DATABASE_URL=your-postgresql-connection-string
AUTH_SECRET=your-generated-secret
```

### Optional (For Google OAuth)

```bash
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
```

### Additional (Recommended)

```bash
AUTH_URL=https://your-app.vercel.app
NEXTAUTH_URL=https://your-app.vercel.app
```

## How to Fix on Vercel

### Step 1: Set Required Environment Variables

1. Go to your Vercel project dashboard
2. Navigate to **Settings** → **Environment Variables**
3. Add these **required** variables:

| Variable       | How to Get It                                                |
| -------------- | ------------------------------------------------------------ |
| `DATABASE_URL` | Your PostgreSQL connection string from Supabase/Neon/Railway |
| `AUTH_SECRET`  | Run: `openssl rand -base64 32`                               |

### Step 2: Redeploy

1. Go to **Deployments** tab
2. Click **⋯** on the latest deployment
3. Select **Redeploy**
4. **Uncheck** "Use existing Build Cache"
5. Click **Redeploy**

### Step 3: Verify

After deployment completes:

- Visit your site
- Try registering a new user
- Check if the 403 error is gone

## If You Want Google OAuth

Only add these if you want Google sign-in:

1. Get credentials from [Google Cloud Console](https://console.cloud.google.com)
2. Add to Vercel environment variables:
   - `GOOGLE_CLIENT_ID`
   - `GOOGLE_CLIENT_SECRET`
3. Redeploy

## Testing Locally

To test the fix locally:

```bash
# Create .env.local with minimum required variables
cat > .env.local << EOF
DATABASE_URL="your-database-url"
AUTH_SECRET="test-secret-at-least-32-characters-long"
EOF

# Build and test
npm run build
npm run dev
```

The app should work without Google OAuth variables.

## Summary

✅ **Fixed:** Environment validation now allows optional OAuth  
✅ **Fixed:** Using correct NextAuth variable names  
✅ **Result:** App works with just `DATABASE_URL` and `AUTH_SECRET`  
✅ **Verified:** Local build succeeds

The 403 error should be resolved after redeploying with the correct environment variables!
